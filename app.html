<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Install YouStillMatter</title>

  <!-- Link to your existing PWA manifest & icons (same origin) -->
  <link rel="manifest" href="/manifest.json">
  <meta name="theme-color" content="#06b6d4">
  <link rel="icon" href="/icons/icon-192.png">
  <link rel="apple-touch-icon" href="/icons/icon-192.png">

  <style>
    :root { color-scheme: light dark; --brand:#06b6d4; --ink:#111827; --muted:#6B7280; }
    * { box-sizing: border-box; }
    body { margin: 0; font: 16px/1.45 system-ui, -apple-system, Segoe UI, Roboto, sans-serif; color: var(--ink); }
    .wrap { max-width: 680px; margin: 0 auto; padding: 24px; }
    .card { border: 1px solid #e5e7eb; border-radius: 14px; padding: 20px; box-shadow: 0 1px 2px rgba(0,0,0,.06), 0 6px 18px rgba(0,0,0,.06); }
    h1 { margin: 0 0 10px; font-size: 1.6rem; }
    p { margin: 0 0 12px; color: var(--muted); }
    .row { display: grid; gap: 12px; grid-template-columns: 1fr; }
    .btn { appearance: none; border-radius: 12px; border: 1px solid #e5e7eb; padding: 12px 16px; background: white; cursor: pointer; }
    .btn.primary { border-color: var(--brand); background: var(--brand); color: white; font-weight: 600; }
    .hint { font-size: .9rem; color: var(--muted); }
    .ios-steps li { margin: 6px 0; }
    .ok { color: #059669; font-weight: 600; }
    .hide { display: none; }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <h1>Install YouStillMatter</h1>
      <p>Quick tools that work offline. Your data stays on your device.</p>

      <!-- Action buttons -->
      <div class="row" style="margin-top:12px">
        <!-- Install button (appears when beforeinstallprompt fires) -->
        <button id="installBtn" class="btn primary hide">➕ Add to Home Screen</button>

        <!-- Fallback: open the app (self-care) right now -->
        <a id="openApp" class="btn" href="/self-care">Open Self-Care</a>
      </div>

      <!-- Status + tips -->
      <div id="status" class="hint" style="margin-top:10px"></div>

      <!-- iOS instructions (only shown for Safari on iOS) -->
      <div id="iosBox" class="card hide" style="margin-top:14px">
        <b>iPhone/iPad:</b>
        <ol class="ios-steps">
          <li>Open this page in <b>Safari</b>.</li>
          <li>Tap the <b>Share</b> button.</li>
          <li>Choose <b>Add to Home Screen</b>.</li>
          <li>Launch the icon; it opens <b>Self-Care</b>.</li>
        </ol>
      </div>

      <!-- Already installed message -->
      <div id="installedBox" class="hint hide" style="margin-top:10px">
        <span class="ok">✓ Installed.</span> If the app is already on your Home screen, you can close this page.
      </div>
    </div>
  </div>

  <script>
    // If your SW is at /sw.js, this registers it so the page counts as installable.
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('/sw.js').catch(()=>{});
    }

    // Detect standalone (already installed)
    const inStandalone = window.matchMedia('(display-mode: standalone)').matches || window.navigator.standalone;
    const installedBox = document.getElementById('installedBox');
    if (inStandalone) installedBox.classList.remove('hide');

    const isIOS = /iphone|ipad|ipod/i.test(navigator.userAgent);
    const isSafari = /^((?!chrome|android).)*safari/i.test(navigator.userAgent);
    const iosBox = document.getElementById('iosBox');
    if (isIOS && isSafari) iosBox.classList.remove('hide');

    const installBtn = document.getElementById('installBtn');
    const status = document.getElementById('status');
    let deferredPrompt = null;

    window.addEventListener('beforeinstallprompt', (e) => {
      // Only fires on Chrome/Edge/Android and same-origin
      e.preventDefault();
      deferredPrompt = e;
      installBtn.classList.remove('hide');
      status.textContent = 'Tip: You can install this app for quick access offline.';
    });

    installBtn?.addEventListener('click', async () => {
      if (!deferredPrompt) return;
      try {
        deferredPrompt.prompt();
        const { outcome } = await deferredPrompt.userChoice;
        status.textContent = outcome === 'accepted'
          ? 'Thanks! App installed.'
          : 'Install dismissed. You can try again anytime.';
      } catch (err) {
        status.textContent = 'Couldn’t show the install prompt. You can still use the app now.';
      } finally {
        deferredPrompt = null;
        installBtn.classList.add('hide');
      }
    });
  </script>
</body>
</html>
